<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#7b4b2a" />
  <meta name="description" content="Personal book library tracker across all formats" />
  <title>üìö Bookish</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192x192.png" />
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- Main App Container -->
  <div id="app">
    
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <div class="header-left">
          <h1>üìö Bookish</h1>
          <p id="bookCount">0 books</p>
        </div>
        <div class="header-actions">
          <button id="importBtn" class="header-btn" title="Import Books">‚Üì</button>
          <button id="exportBtn" class="header-btn" title="Export Books">‚Üë</button>
          <button id="addBookBtn" class="header-btn-primary">+ Add Book</button>
        </div>
      </div>
    </header>

    <!-- Filters Section -->
    <div class="filters-section">
      <!-- Search -->
      <div class="filter-row">
        <input 
          type="text" 
          id="searchInput" 
          class="search-input" 
          placeholder="Search title, author, genre, notes..." 
        />
      </div>

      <!-- Filter Dropdowns -->
      <div class="filter-row filter-grid">
        <select id="fictionFilter" class="filter-select">
          <option value="">All Types</option>
          <option value="Fiction">Fiction</option>
          <option value="Nonfiction">Nonfiction</option>
        </select>

        <select id="genreFilter" class="filter-select">
          <option value="">All Genres</option>
        </select>

        <select id="statusFilter" class="filter-select">
          <option value="">All Status</option>
          <option value="unread">Unread</option>
          <option value="reading">Reading</option>
          <option value="read">Read</option>
        </select>
      </div>

      <!-- Format Checkboxes -->
      <div class="filter-row format-checkboxes">
        <label>
          <input type="checkbox" id="filterPhysical" value="physical" />
          üìï Physical
        </label>
        <label>
          <input type="checkbox" id="filterKindle" value="kindle" />
          üì± Kindle
        </label>
        <label>
          <input type="checkbox" id="filterAudible" value="audible" />
          üéß Audible
        </label>
      </div>

      <!-- Results Count -->
      <div class="results-count" id="resultsCount">
        <span id="shownCount">0</span> shown of <span id="totalCount">0</span> total
      </div>
    </div>

    <!-- Books Table -->
    <div class="table-container">
      <table class="books-table">
        <thead>
          <tr>
            <th data-sort="title" class="sortable">
              Title <span class="sort-indicator"></span>
            </th>
            <th data-sort="author" class="sortable">
              Author <span class="sort-indicator"></span>
            </th>
            <th data-sort="genre" class="sortable">
              Genre <span class="sort-indicator"></span>
            </th>
            <th data-sort="status" class="sortable">
              Status <span class="sort-indicator"></span>
            </th>
            <th>Formats</th>
          </tr>
        </thead>
        <tbody id="booksTableBody">
          <!-- Books populated by JavaScript -->
        </tbody>
      </table>
    </div>

  </div>

  <!-- Book Detail Sheet (Bottom Sheet) -->
  <div id="detailSheet" class="detail-sheet">
    <div class="detail-backdrop"></div>
    <div class="detail-content">
      <button class="detail-close" id="detailClose">√ó</button>
      
      <div class="detail-body">
        <h2 id="detailTitle"></h2>
        <p class="detail-author" id="detailAuthor"></p>
        <p class="detail-meta" id="detailMeta"></p>
        <div class="detail-formats" id="detailFormats"></div>
        <p class="detail-notes" id="detailNotes"></p>
        <div class="detail-tags" id="detailTags"></div>
      </div>

      <div class="detail-actions">
        <button id="amazonOpen" class="action-btn">üîó Open on Amazon</button>
        <button id="amazonCopy" class="action-btn">üìã Copy Amazon Link</button>
        <button id="editBookBtn" class="action-btn">‚úèÔ∏è Edit</button>
        <button id="deleteBookBtn" class="action-btn-danger">üóëÔ∏è Delete</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Book Modal -->
  <div id="bookModal" class="modal">
    <div class="modal-backdrop" id="bookModalBackdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Add Book</h2>
        <button class="modal-close" id="bookModalClose">√ó</button>
      </div>

      <div class="modal-body">
        <form id="bookForm">
          
          <!-- Quick Add Options -->
          <div class="quick-add-section">
            <h3>üì∑ Quick Add by Photo</h3>
            <div class="quick-add-buttons">
              <button type="button" id="scanBarcodeBtn" class="quick-btn">
                üì∑ Scan ISBN Barcode
              </button>
              <button type="button" id="scanTitleBtn" class="quick-btn">
                üìñ Scan Title Page
              </button>
              <button type="button" id="scanSpineBtn" class="quick-btn">
                üìö Scan Spine
              </button>
            </div>
          </div>

          <div class="form-divider">
            <span>OR USE ISBN LOOKUP</span>
          </div>

          <!-- ISBN Lookup -->
          <div class="isbn-lookup-section">
            <div class="isbn-input-group">
              <input 
                type="text" 
                id="isbnInput" 
                class="form-input"
                placeholder="Paste ISBN here (10 or 13 digits)" 
              />
              <button type="button" id="isbnLookupBtn" class="btn-primary">
                üîç Lookup
              </button>
            </div>
            <p class="help-text">
              Use iPhone Camera app ‚Üí Point at barcode ‚Üí Tap ISBN ‚Üí Copy ‚Üí Paste here
            </p>
          </div>

          <div class="form-divider">
            <span>OR ENTER MANUALLY</span>
          </div>

          <!-- Manual Entry Form -->
          <div class="form-grid">
            <div class="form-group">
              <label for="bookTitle">Title *</label>
              <input type="text" id="bookTitle" class="form-input" required />
            </div>

            <div class="form-group">
              <label for="bookAuthor">Author *</label>
              <input type="text" id="bookAuthor" class="form-input" required />
            </div>

            <div class="form-group">
              <label for="bookGenre">Genre *</label>
              <select id="bookGenre" class="form-input" required>
                <option value="">Select Genre</option>
                <optgroup label="Fiction">
                  <option value="Literary Fiction">Literary Fiction</option>
                  <option value="Mystery/Thriller">Mystery/Thriller</option>
                  <option value="Science Fiction">Science Fiction</option>
                  <option value="Fantasy">Fantasy</option>
                  <option value="Romance">Romance</option>
                  <option value="Historical Fiction">Historical Fiction</option>
                  <option value="Horror">Horror</option>
                </optgroup>
                <optgroup label="Nonfiction">
                  <option value="Biography/Memoir">Biography/Memoir</option>
                  <option value="History">History</option>
                  <option value="Science">Science</option>
                  <option value="Philosophy">Philosophy</option>
                  <option value="Business">Business</option>
                  <option value="Self-Help">Self-Help</option>
                  <option value="True Crime">True Crime</option>
                  <option value="Essay Collection">Essay Collection</option>
                  <option value="Politics/Current Events">Politics/Current Events</option>
                </optgroup>
                <optgroup label="Other">
                  <option value="Poetry">Poetry</option>
                  <option value="Graphic Novel">Graphic Novel</option>
                  <option value="Young Adult">Young Adult</option>
                </optgroup>
              </select>
            </div>

            <div class="form-group">
              <label for="bookFictionType">Fiction Type *</label>
              <select id="bookFictionType" class="form-input" required>
                <option value="">Select Type</option>
                <option value="Fiction">Fiction</option>
                <option value="Nonfiction">Nonfiction</option>
              </select>
            </div>

            <div class="form-group">
              <label for="bookDifficulty">Difficulty *</label>
              <select id="bookDifficulty" class="form-input" required>
                <option value="">Select Difficulty</option>
                <option value="Light">Light</option>
                <option value="Moderate">Moderate</option>
                <option value="Dense">Dense</option>
              </select>
            </div>

            <div class="form-group">
              <label for="bookStatus">Status *</label>
              <select id="bookStatus" class="form-input" required>
                <option value="">Select Status</option>
                <option value="unread">Unread</option>
                <option value="reading">Reading</option>
                <option value="read">Read</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label>Formats * (at least one required)</label>
              <div class="format-checkboxes">
                <label>
                  <input type="checkbox" id="formatPhysical" value="physical" />
                  üìï Physical
                </label>
                <label>
                  <input type="checkbox" id="formatKindle" value="kindle" />
                  üì± Kindle
                </label>
                <label>
                  <input type="checkbox" id="formatAudible" value="audible" />
                  üéß Audible
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="bookISBN">ISBN</label>
              <input type="text" id="bookISBN" class="form-input" />
            </div>

            <div class="form-group">
              <label for="bookPublicationDate">Publication Date</label>
              <input type="date" id="bookPublicationDate" class="form-input" />
            </div>

            <div class="form-group">
              <label for="bookAcquiredDate">Acquired Date</label>
              <input type="date" id="bookAcquiredDate" class="form-input" />
            </div>

            <div class="form-group">
              <label for="bookCoverUrl">Cover URL</label>
              <input type="url" id="bookCoverUrl" class="form-input" placeholder="https://..." />
            </div>

            <div class="form-group full-width">
              <label for="bookNotes">Notes</label>
              <textarea id="bookNotes" class="form-input" rows="3"></textarea>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" id="cancelBtn" class="btn-secondary">Cancel</button>
            <button type="submit" class="btn-primary">Save Book</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Barcode Scanner Modal -->
  <div id="barcodeModal" class="modal">
    <div class="modal-backdrop" id="barcodeModalBackdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2>üì∑ Scan Barcode</h2>
        <button class="modal-close" id="barcodeModalClose">√ó</button>
      </div>
      <div class="modal-body">
        <div id="barcodeScannerContainer"></div>
        <p id="barcodeStatus" style="text-align: center; margin-top: 1rem;">Position barcode in frame...</p>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Hidden File Input for Import -->
  <input type="file" id="importFile" accept=".json" style="display: none;" />

  <!-- JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2@1.8.4/dist/quagga.min.js"></script>
  
  <!-- JavaScript Modules -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
